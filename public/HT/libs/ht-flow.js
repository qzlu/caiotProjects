!function(h){"use strict";var a=h.ht,O=a.Default,Q=O.getInternal(),S=Q.ui(),Y=null,o="__segmentLengths",r="__lineTotalLength",b="__linePoints",q="__distance0",L="flow.count",f="flow.step",u="flow.element.max",k="flow.element.count",e="flow.element.min",s="flow.element.space",F="flow.element.autorotate",C="flow.element.background",t="flow.element.shadow.max",p="flow.element.shadow.min",B="flow.element.shadow.begincolor",I="flow.element.shadow.endcolor",W="flow.element.shadow.visible",A="flow.element.image",R="flow",m=a.Math.Vector2,v=new m;new m,new m,a.List;var P=a.Default._edgeProtectMethod,z=P.getStraightLinePoints,x=function(H,s){for(var t=[],L=H.length,x=0;L>x;x++){var r=H[x];r._as&&(r=r._as);for(var Y=r[0],w=1;w<r.length;w++)t.push([Y,r[w]]),Y=r[w]}for(var u=[],x=0;x<t.length;x++){var F=G(t[x][0],t[x][1],s);u.push(F)}return{distance:u,segments:t}},U=function(g,b,e){if(g){for(var Y,d=x(g,b),$=d.distance,L=d.segments,M=1/0,v=null,m=0,X=$.length;X>m;m++){var K=$[m];K.z<M&&(Y=m,M=K.z,v=K)}if(null==e&&(e=.1),v.z<e){for(var R=0,j=0;Y>=j;j++)R+=O.getDistance(L[j][0],Y>j?L[j][1]:v);return R}}},G=function(N,n,L){var H=N.x,G=N.y,E=n.x,J=n.y,r=L.x,a=L.y,V=E-H,$=J-G,P=Math.sqrt(V*V+$*$),K=V/P,o=$/P,q=(-H+r)*K+(-G+a)*o,X={x:H+q*K,y:G+q*o};return X.x>=Math.min(N.x,n.x)&&X.x<=Math.max(N.x,n.x)&&X.y>=Math.min(N.y,n.y)&&X.y<=Math.max(N.y,n.y)||(X.x=Math.abs(X.x-N.x)<Math.abs(X.x-n.x)?N.x:n.x,X.y=Math.abs(X.y-N.y)<Math.abs(X.y-n.y)?N.y:n.y),V=r-X.x,$=a-X.y,X.z=Math.sqrt(V*V+$*$),X},_=function(C,U){if(C){var r=x(C,U).distance,B=1/0,n=null;return r.forEach(function(m){m.z<B&&(B=m.z,n=m)}),n}},H=P.calculateLineLength,T=P.calcSegmentIndexByDistance,Z=P.calculatePointAlongLine,g=function(v,s,t){if(!v)return t;if(0===s){var _=v[0][0],l=v[0][1];return t+Math.atan2(l.y-_.y,l.x-_.x)}if(100===s){v=v[v.length-1];var _=v[v.length-2],l=v[v.length-1];return t+Math.atan2(l.y-_.y,l.x-_.x)}for(var y=0,Q=[],C=v.length,u=0;C>u;u++){var k=v[u],W=H(k);y+=W,Q.push(W)}for(var i=y*s/100,b=T(i,Q),$=0,K=0;b>K;K++)$+=Q[K];i-=$;for(var p=Z(v[b],i),A=v[b],c=0,x=0,X=0;X<A.length-1;X++){var e=A[X],o=A[X+1],g=o.x-e.x,M=o.y-e.y,R=Math.sqrt(g*g+M*M);if(c+=R,c>i){x=X;break}}var z=A[x];return t+Math.atan2(p.y-z.y,p.x-z.x)},J=function(b){var g=0;if(b)if(Array.isArray(b[0]))for(var w=b.length,J=0;w>J;J++){var B=b[J],F=H(B);g+=F}else g=H(b);return g},N=function(L,m,C,F){return v.set(m,C).rotateAround(null,F),L?{x:L.x+v.x,y:L.y+v.y}:{x:v.x,y:v.y}},c=function(W){var f=W._data,P=z(W);if(P){f.s("flow.reverse")&&(P.reverse(),P.forEach(function(e){e.reverse()}));for(var R=0,Q=[],x=P.length,m=0;x>m;m++){var y=P[m],l=H(y);R+=l,Q.push(l)}if(f[o]=Q,f[r]=R,f[b]=P,f instanceof a.Edge){var p=O.unionPoint(P),B=p.x+p.width/2,F=p.y+p.height/2;f.$10e={x:B,y:F}}d(W,!0)}},M=P.getPercentPosition,d=function(y,i){var p=y._data,h=p[r],v=p.s(L),J=p.s(f),A=0,$=p[o],m=p.s(u),U=p.s(e),O=p.s(k),V=(m-U)/(O-1),s=[];if($){if(1===O)s.push(m);else if(2===O)s.push(m),s.push(U);else{if(!(O>2))return;s.push(m);for(var c=O-2;c>0;c--)s.push(U+V*c);s.push(U)}var n=0,W=0;s.forEach(function(_){O-1>n&&(W+=p.getFlowElementSpace(_)),n++}),W+=(m+U)/2,A=(h-v*W+W)/v;var g=y[q];for(null==g&&(g=0),i||(g+=J);g>h+W;){var H=y._overCount;H?H++:H=1,H>=v&&(H=null),y._overCount=H,p.s("flow.autoreverse")?H?g-=A+W:(g=0,p.s("flow.reverse",!p.s("flow.reverse"))):g-=A+W}y[q]=g}},E="prototype",V=a.graph.GraphView[E],j=a.Data[E],$=S.DataUI[E],n=S.ShapeUI[E],y=S.EdgeUI[E],i=a.DataModel[E],K=a.Style;K[u]==Y&&(K[u]=7),K[e]==Y&&(K[e]=0),K[L]==Y&&(K[L]=1),K[f]==Y&&(K[f]=3),K[k]==Y&&(K[k]=10),K[s]==Y&&(K[s]=3.5),K[F]==Y&&(K[F]=!1),K[C]==Y&&(K[C]="rgba(255, 255, 114, 0.4)"),K[B]==Y&&(K[B]="rgba(255, 255, 0, 0.3)"),K[I]==Y&&(K[I]="rgba(255, 255, 0, 0)"),K[W]==Y&&(K[W]=1),K[t]==Y&&(K[t]=22),K[p]==Y&&(K[p]=4),V.calculatePointLength=function(V,C,x){var T=this.getDataUI(V),d=z(T);return U(d,C,x)},O.calculatePointLength=function(b,C,h,r){var j=z(Y,b,C);return U(j,h,r)},O.calculateClosestPointOnLine=G,V.calculateClosestPoint=function($,x){var r=this.getDataUI($),F=z(r);return _(F,x)},O.calculateClosestPoint=function(v,B,T){var S=z(Y,v,B);return _(S,T)},V.getPercentAngle=function(G,c){var n=this.getDataUI(G),X=z(n);return G.getRotation?G.getRotation():0,g(X,c,G.getRotation?G.getRotation():0)},O.getPercentAngle=function(d,U,b){var q=z(Y,d,U);return g(q,b,0)},V.calculateLength=function($){var v=this.getDataUI($),t=z(v);return J(t)},O.calculateLength=function(d,D){var G=z(Y,d,D);return J(G)},V.getPercentPosition=function(A,b){var I=this.getDataUI(A),S=z(I);return M(S,b)},O.getPercentPositionOnPoints=function(F,N,k){var c=z(Y,F,N);return M(c,k)};var D=function(B){var K=B.data,w=this.dm();if(K&&"add"===B.kind){var m=w.$3e;m&&K.s(R)&&m.indexOf(K)<0&&m.push(K)}"clear"===B.kind&&(w.$3e=[])},X=function(U){var J=U.property,s=U.data,l=U.newValue,W=this.dm().$3e;if(W&&"s:flow"===J)if(l)W.indexOf(s)<0&&W.push(s);else for(var S=W.length,E=0;S>E;E++)if(W[E]===s){W.splice(E,1);break}},w=V.setDataModel;V.setDataModel=function(v){var K=this,e=K._dataModel;if(e!==v){e&&(e.umm(D,K),e.umd(X,K),e.$3e=[]),v.mm(D,K),v.md(X,K);var r=v.$3e=[];v.each(function(x){x.s(R)&&r.indexOf(x)<0&&r.push(x)}),w.call(K,v)}},j.getFlowElementSpace=function(){return this.s(s)};var l=function(c){var d=this,w=d._data,x=w[r],D=w[o],I=w[b],P=w.s(L),a=0,J=d[q],H=w.s(u),Q=w.s(e),K=w.s(k),m=w.s(p),v=w.s(t),f=w.s(F),A=(v-m)/(K-1),l=(H-Q)/(K-1),O=w.getRotation?w.getRotation():0,h=w.getPosition?w.p():w.$10e,E=[],n=[];if(J!=Y){if(1===K)E.push(H);else if(2===K)E.push(H),E.push(Q);else{if(!(K>2))return;E.push(H);for(var V=K-2;V>0;V--)E.push(Q+l*V);E.push(Q)}if(1===K)n.push(v);else if(2===K)n.push(v),n.push(m);else{if(!(K>2))return;n.push(v);for(var V=K-2;V>0;V--)n.push(m+A*V);n.push(m)}var W=0,B=0;E.forEach(function(c){K-1>W&&(B+=w.getFlowElementSpace(c)),W++}),B+=(H+Q)/2,a=(x-P*B+B)/P,c.save();for(var V=0;P>V;V++){var y=J,j=0,i=d._overCount,U=0;w.s("flow.autoreverse")&&i&&i>P-(V+1)||(y-=V*(a+B),W=0,E.forEach(function(o){var r=y-j;if(r>=0&&x>r){var s=!0,B=T(r,D);U=0;for(var t=0;B>t;t++)U+=D[t];if(r-=U,s){var C=Z(I[B],r),S=O;if(f){for(var e=I[B],M=0,V=0,$=0;$<e.length-1;$++){var p=e[$],g=e[$+1],u=g.x-p.x,q=g.y-p.y,b=Math.sqrt(u*u+q*q);if(M+=b,M>r){V=$;break}}var Q=e[V];S+=Math.atan2(C.y-Q.y,C.x-Q.x)}O&&(C=N(h,C.x-h.x,C.y-h.y,O)),d.$5e(c,C,o,n[W],S)}}j+=w.getFlowElementSpace(E[W]),W++}))}c.restore()}},Sd=y._80o;y._80o=function(W){Sd.call(this,W);var O=this,n=O._data,Z=O.gv;n.s(R)&&Z.$7e!=Y&&l.call(O,W)};var Oo=n._80o;n._80o=function(J){Oo.call(this,J);var g=this,f=g._data,Q=g.gv;f.s(R)&&Q.$7e!=Y&&l.call(g,J)};var rb=y._79o,os=n._79o,dc=function(){var h=this,E=h._data,K=E.s(u),M=!1,e=Y;if(h._6I||(M=!0),e=E instanceof a.Edge?rb.call(h):os.call(h),E.s(R)&&M){var T=E.s(t),N=E.s(W);N&&T>K&&(K=T),K>0&&O.grow(e,Math.ceil(K/2)),c(h)}return!E.s(R)&&M&&(E[o]=E[r]=E[b]=h[q]=Y),e};n._79o=dc,y._79o=dc,$.$5e=function(v,K,r,F,X){var d=this,$=d._data,o=d.gv,b=$.s(C),s=$.s(B),u=$.s(I),N=$.s(W),L=o.$8e,x=$.s(A);if(L==Y&&(L=o.$8e={}),v.beginPath(),x!=Y){var l=O.getImage(x),t=r/2;v.translate(K.x,K.y),v.rotate(X),v.translate(-K.x,-K.y),O.drawImage(v,l,K.x-t,K.y-t,r,r,$),v.translate(K.x,K.y),v.rotate(-X),v.translate(-K.x,-K.y)}else if(o.__flowBatch){var E=o.__flowBatchGroup;E||(E=o.__flowBatchGroup={});var g=[K.x,K.y,r/2];E[b]?E[b].push(g):E[b]=[g]}else v.fillStyle=b,v.arc(K.x,K.y,r/2,0,2*Math.PI,!0),v.fill();if(N){var h=22,S=h+"_"+s+"_"+u,D=L[S];if(D==Y){var w=document.createElement("canvas");Q.setCanvas(w,h,h);var n=w.getContext("2d"),R=h/2,c=R,z=R;Q.translateAndScale(n,0,0,1),n.beginPath();var G=n.createRadialGradient(c,z,0,c,c,R);G.addColorStop(0,s),G.addColorStop(1,u),n.fillStyle=G,n.arc(c,z,R,0,2*Math.PI,!0),n.fill(),D=L[S]=w}var t=F/2;O.drawImage(v,D,K.x-t,K.y-t,F,F,$)}},V.$9e=function(){var F=this,f=F.dm().$3e;F._24I,f.forEach(function(I){F._24I[I._id]=I}),F.iv()};var Tk=i.prepareRemove;i.prepareRemove=function(K){Tk.call(this,K);var C=K._dataModel,o=C.$3e;if(o)for(var H=o.length,M=0;H>M;M++)if(o[M]===K){o.splice(M,1);break}},V.setFlowInterval=function(m){var C=this,A=C.$11e;C.$11e=m,C.fp("flowInterval",A,m),C.$7e!=Y&&(clearInterval(C.$7e),delete C.$7e,C.enableFlow(m))},V.getFlowInterval=function(){return this.$11e},V.enableFlow=function(N){var p=this,Z=p.dm(),m=Z.$3e;p.$7e==Y&&(m.forEach(function(C){var n=p.getDataUI(C);c(n)}),p.$7e=setInterval(function(){Z.$3e.forEach(function(T){d(p.getDataUI(T))}),p.$9e()},N||p.$11e||50))},V.disableFlow=function(){var i=this;clearInterval(i.$7e),delete i.$7e;var F=i.dm().$3e;F&&i.$9e()};var Dr=function(){this.__flowBatchGroup={}},cj=function(v){var k=this.__flowBatchGroup;if(k){v.save();for(var K in k){v.fillStyle=K,v.beginPath();var w=k[K];w.forEach(function(f){v.moveTo(f[0],f[1]),v.arc(f[0],f[1],f[2],0,2*Math.PI,!0)}),v.fill()}v.restore()}};V.setFlowBatch=function(q){var K=this;!!K.__flowBatch!=!!q&&(K.__flowBatch=q,q?(K.addBottomPainter(Dr),K.addTopPainter(cj)):(K.removeBottomPainter(Dr),K.removeTopPainter(cj)))}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);
!function(k,R,m){"use strict";var w=k.ht;w.Astar={},function(m){var B=m();k.AStar=B.astar,k.AStar.Graph=B.Graph}(function(){function Z(x){for(var $=x,K=[];$.parent;)K.unshift($),$=$.parent;return K}function a(){return new d(function(b){return b.f})}function I(V,c){c=c||{},this.nodes=[],this.diagonal=!!c.diagonal,this.grid=[];for(var s=0;s<V.length;s++){this.grid[s]=[];for(var r=0,h=V[s];r<h.length;r++){var Q=new O(s,r,h[r]);this.grid[s][r]=Q,this.nodes.push(Q)}}this.$13x()}function O(k,s,c){this.x=k,this.y=s,this.weight=c}function d(p){this.content=[],this.scoreFunction=p}var L={search:function(h,A,R,f){h.$6x(),f=f||{};var Q=f.heuristic;Q||(Q=h.diagonal?L.$4x.diagonal:L.$4x.manhattan);var H=f.closest||!1,d=f.punish,y=a(),w=A;for(A.h=Q(A,R),h.$7x(A),y.push(A);y.size()>0;){var q=y.pop();if(q===R)return Z(q);q.closed=!0;for(var C=h.neighbors(q),W=0,v=C.length;v>W;++W){var e=C[W];if(!e.closed&&!e.$9x()){var X=q.g+e.getCost(q,d),j=e.visited;(!j||X<e.g)&&(e.visited=!0,e.parent=q,e.h=e.h||Q(e,R),e.g=X,e.f=e.g+e.h,h.$7x(e),H&&(e.h<w.h||e.h===w.h&&e.g<w.g)&&(w=e),j?y.$10x(e):y.push(e))}}}return H?Z(w):[]},$4x:{manhattan:function(V,W){var L=Math.abs(W.x-V.x),q=Math.abs(W.y-V.y);return L+q},diagonal:function(E,p){var u=1,V=Math.sqrt(2),Z=Math.abs(p.x-E.x),G=Math.abs(p.y-E.y);return u*(Z+G)+(V-2*u)*Math.min(Z,G)}},$5x:function(m){m.f=0,m.g=0,m.h=0,m.visited=!1,m.closed=!1,m.parent=null}};return I.prototype.$13x=function(){this.dirtyNodes=[];for(var p=0;p<this.nodes.length;p++)L.$5x(this.nodes[p])},I.prototype.$6x=function(){for(var x=0;x<this.dirtyNodes.length;x++)L.$5x(this.dirtyNodes[x]);this.dirtyNodes=[]},I.prototype.$7x=function(g){this.dirtyNodes.push(g)},I.prototype.neighbors=function(_){var z=[],E=_.x,w=_.y,u=this.grid;return u[E-1]&&u[E-1][w]&&z.push(u[E-1][w]),u[E+1]&&u[E+1][w]&&z.push(u[E+1][w]),u[E]&&u[E][w-1]&&z.push(u[E][w-1]),u[E]&&u[E][w+1]&&z.push(u[E][w+1]),this.diagonal&&(u[E-1]&&u[E-1][w-1]&&z.push(u[E-1][w-1]),u[E+1]&&u[E+1][w-1]&&z.push(u[E+1][w-1]),u[E-1]&&u[E-1][w+1]&&z.push(u[E-1][w+1]),u[E+1]&&u[E+1][w+1]&&z.push(u[E+1][w+1])),z},I.prototype.toString=function(){for(var J=[],E=this.grid,c=0;c<E.length;c++){for(var x=[],t=E[c],u=0;u<t.length;u++)x.push(t[u].weight);J.push(x.join(" "))}return J.join("\n")},O.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},O.prototype.getCost=function(N,v){var d;if(d=N&&N.x!=this.x&&N.y!=this.y?1.41421*this.weight:this.weight,v){var D=N;if(!D)return d;var m=D.parent;return m?Math.abs(m.x+this.x-2*D.x)>1e-5?d+v:Math.abs(m.y+this.y-2*D.y)>1e-5?d+v:d:d}},O.prototype.$9x=function(){return 0===this.weight},d.prototype={push:function(W){this.content.push(W),this.$11x(this.content.length-1)},pop:function(){var l=this.content[0],n=this.content.pop();return this.content.length>0&&(this.content[0]=n,this.$12x(0)),l},remove:function(D){var r=this.content.indexOf(D),p=this.content.pop();r!==this.content.length-1&&(this.content[r]=p,this.scoreFunction(p)<this.scoreFunction(D)?this.$11x(r):this.$12x(r))},size:function(){return this.content.length},$10x:function(k){this.$11x(this.content.indexOf(k))},$11x:function(w){for(var q=this.content[w];w>0;){var h=(w+1>>1)-1,X=this.content[h];if(!(this.scoreFunction(q)<this.scoreFunction(X)))break;this.content[h]=q,this.content[w]=X,w=h}},$12x:function(T){for(var S=this.content.length,f=this.content[T],e=this.scoreFunction(f);;){var O,I=T+1<<1,h=I-1,$=null;if(S>h){var b=this.content[h];O=this.scoreFunction(b),e>O&&($=h)}if(S>I){var g=this.content[I],s=this.scoreFunction(g);(null===$?e:O)>s&&($=I)}if(null===$)break;this.content[T]=this.content[$],this.content[$]=f,T=$}}},{astar:L,Graph:I}});var E=w.Astar.Finder=function(N,S){var Q=this;Q.gv=N,Q.$13x(S),Q.refreshMap()};E.prototype={},E.prototype.constructor=E,R.defineProperties(E.prototype,{_debugInfo:{get:function(){return this.gv._astarDebugInfo},set:function(i){this.gv._astarDebugInfo=i}}}),E.prototype.$13x=function(j){var g=this,b=g.$14x={};j=j||{};var t=j.gridSize||10;b.gridSizeX=j.gridSizeX||t,b.gridSizeY=j.gridSizeY||t,b.rect=j.rect,b.filter=j.filter,b.extendBlocks=j.extendBlocks||3,b.fastOverlap=j.fastOverlap===m?!0:j.fastOverlap,b.nodeRectExtend=j.nodeRectExtend||0,b.diagonal=j.diagonal===m?!0:j.diagonal,b.turnPunish=j.turnPunish===m?.1:j.turnPunish,b.simplify=j.simplify===m?!0:j.simplify,b.toGridCenter=j.toGridCenter===m?!1:j.toGridCenter,b.closest=j.closest===m?!0:j.closest},E.prototype.refreshMap=function(){var F,m=this,Q=m.$14x,y=Q.gridSizeX,k=Q.gridSizeY,v=Q.extendBlocks;Q.rect?F=Q.rect:(F=m.$15x(),w.Default.grow(F,y*v,k*v)),w.Default.grow(F,y,k);var Y=Math.floor(F.x/y)*y,K=Math.floor(F.y/k)*k,T=Math.ceil(F.width/y),Z=Math.ceil(F.height/k),A=T*y,R=Z*k;m.$16x={x:Y,y:K,w:A,h:R,gridX:y,gridY:k,xLen:T,yLen:Z},m.$17x(),m.$21x()},E.prototype.$15x=function(){var y=this.gv;if(y instanceof w.graph.GraphView)return y.getContentRect();var S,X=w.Default.unionRect;return y.dm().each(function(L){y.isVisible(L)&&L.getRect&&(S=X(S,L.getRect()))}),S},E.prototype.$17x=function(){var c,D,W,B,J=this,z=J.$16x,k=z.xLen,Y=z.yLen;for(c=new Array(k),W=0;k>W;W++)for(c[W]=D=new Array(Y),B=Y;B--;)D[B]=1;var V=J.$14x.filter;for(J.gv.dm().each(function(D){V&&V(D)===!1||(!J._debugInfo||D!==J._debugInfo.grid&&D!=J._debugInfo.path)&&J.$1cw(c,D)}),W=0;k>W;W++)c[W][0]=1,c[W][Y-1]=1;for(B=0;Y>B;B++)c[0][B]=1,c[k-1][B]=1;J.grid=c;var R=new AStar.Graph(c,{diagonal:J.$14x.diagonal});J.graph=R},E.prototype.$18x=function(a,v,W,L,Y,G,I,m){var k=this.$19x,Q=k(W-a,Y-I,L-v,G-m);if(1e-6>=Q&&Q>=-1e-6)return!1;var B=k(Y-a,Y-I,G-v,G-m)/Q;if(0>B||B>1)return!1;var b=k(W-a,Y-a,L-v,G-v)/Q;return 0>b||b>1?!1:!0},E.prototype.$19x=function(X,F,I,P){return X*P-F*I},E.prototype.$1aw=function(n,U,P,w){for(var g=[-(U[1]-n[1]),U[0]-n[0]],K=g[0]*(P[0]-n[0])+g[1]*(P[1]-n[1])>=0,l=0,c=w.length;c>l;l+=2)if(g[0]*(w[l]-n[0])+g[1]*(w[l+1]-n[1])>=0===K)return!1;return!0},E.prototype.$1bw=function(R,J){for(var j,E,r=this,G=0,v=R.length;v>G;G+=2)if(j=G===v-2?0:G+2,E=j===v-2?0:j+2,r.$1aw([R[G],R[G+1]],[R[j],R[j+1]],[R[E],R[E+1]],J))return!1;for(var G=0,v=J.length;v>G;G+=2)if(j=G===v-2?0:G+2,E=j===v-2?0:j+2,r.$1aw([J[G],J[G+1]],[J[j],J[j+1]],[J[E],J[E+1]],R))return!1;return!0},E.prototype.$1cw=function(s,d){if(d.getRect){var o=this,j=d.getRect();w.Default.grow(j,o.$14x.nodeRectExtend);var _,v,G,K,O,D,R,u,Q,A,r,I=o.$1dw({x:j.x,y:j.y}),h=o.$1dw({x:j.x+j.width,y:j.y+j.height}),l=o.$14x.fastOverlap;if(!l){var i=d.getCorners();R=[],i.forEach(function(w){R.push(w.x,w.y)}),A=o.$14x.gridSizeX/2,r=o.$14x.gridSizeY/2}for(v=Math.max(0,I.x),G=Math.min(h.x,s.length-1),O=Math.max(0,I.y),D=Math.min(h.y,s.length?s[0].length-1:-1),_=v;G>=_;_++)for(K=O;D>=K;K++)if(l)s[_][K]=0;else{Q=o.$1ew({x:_,y:K});var y=Q.x-A,m=Q.x+A,E=Q.y-r,Y=Q.y+r;u=[y,E,y,Y,m,Y,m,E],o.$1bw(R,u)&&(s[_][K]=0)}}},E.prototype.$1dw=function(X,j){var q=this,A=q.$16x,Y=(X.x-A.x)/A.gridX,$=(X.y-A.y)/A.gridY;return j!==!1&&(Y=Math.round(Y),$=Math.round($)),{x:Y,y:$}},E.prototype.$1ew=function(Q){var P=this,y=P.$16x;return{x:Q.x*y.gridX+y.x,y:Q.y*y.gridY+y.y}},E.prototype.$1fw=function(A){var q=this,S=q.$16x,e=S.xLen,t=S.yLen;if(A.x>=0&&A.x<e&&A.y>=0&&A.y<t)return A;var y={x:A.x,y:A.y};return y.x<0?y.x=0:y.x>=e&&(y.x=e-1),y.y<0?y.y=0:y.y>=t&&(y.y=t-1),y},E.prototype.findPath=function(K,L){var r,P,Y,F,m=this,J=m.$1dw(K),y=m.$1dw(L);if(Y=m.$1fw(J),F=m.$1fw(y),Y!==J&&F!==y){var j=m.$16x,e=j.x-j.gridX/2,G=j.y-j.gridY/2,W=e+j.gridX*j.xLen,T=G+j.gridY*j.yLen;if(!(m.$18x(K.x,K.y,L.x,L.y,e,G,W,G)||m.$18x(K.x,K.y,L.x,L.y,W,G,W,T)||m.$18x(K.x,K.y,L.x,L.y,W,T,e,T)||m.$18x(K.x,K.y,L.x,L.y,e,T,e,G)))return[K,L]}Y!==J&&(r=!0,J=Y),F!==y&&(P=!0,y=F);var I=m.graph.grid[J.x][J.y],c=m.graph.grid[y.x][y.y],O=AStar.search(m.graph,I,c,{closest:m.$14x.closest,punish:m.$14x.turnPunish});if(!O||!O.length)return null;var z=[];z.push(K),r&&z.push(m.$1ew(O[0]));for(var C=1,v=O.length;v-1>C;C++)z.push(m.$1ew(O[C]));if(P)z.push(m.$1ew(O[v-1])),z.push(L);else{var M=O[v-1];y.x!==M.x||y.y!==M.y||m.$14x.toGridCenter?z.push(m.$1ew(M)):z.push(L)}return m.$14x.simplify&&(z=m.simplifyPath(z)),m.$20x=z,m.$21x(),z},E.prototype.debugOn=function(K){this.debugFlag=!0,this.debugSettings=K||{},this.$21x()},E.prototype.simplifyPath=function(Q){var R=Q.length;if(2>=R)return Q;var Z,K,r=[Q[0],Q[1]],n=r[0],U=r[1],Y=1e-5;for(Z=2;R>Z;Z++)K=Q[Z],Math.abs((U.x-n.x)*(K.y-n.y)-(U.y-n.y)*(K.x-n.x))<Y?U=r[r.length-1]=K:(n=U,U=K,r.push(K));return r},E.prototype.$21x=function(){var _=this;if(_.$22x(),this.debugFlag){var s=_.grid;if(s){var U,q=_.gv;if(_.debugSettings.$16x!==!1){U=[];for(var e,f,G,k,T,x=[],u=_.$14x.gridSizeX/2,K=_.$14x.gridSizeY/2,C=s.length,p=C?s[0].length:0,I=1;C-1>I;I++)for(var z=1;p-1>z;z++)s[I][z]||(e=_.$1ew({x:I,y:z}),f=e.x-u,G=e.x+u,k=e.y-K,T=e.y+K,U.push({x:f,y:k},{x:f,y:T},{x:G,y:T},{x:G,y:k}),x.push(1,2,2,2,5));var l=new w.Shape;l.s("shape.border.color","rgba(50, 50, 50, 0.2)"),l.s("shape.border.width",1),l.s("shape.background","rgba(200, 50, 100, 0.2)"),l.s("2d.editable",!1),l.s("2d.selectable",!1),l.setPoints(U),l.setSegments(x),_._debugInfo={grid:l},q.dm().add(l)}_.debugSettings.path!==!1&&(U=new w.Shape,_.$20x&&(U.setPoints(_.$20x),U.s("shape.border.color","red"),U.s("shape.border.width",1),U.s("2d.editable",!1),U.s("2d.selectable",!1),U.s("shape.background",null),_._debugInfo||(_._debugInfo={}),_._debugInfo.path=U,q.dm().add(U)))}}},E.prototype.debugOff=function(){this.debugFlag=!1,this.$22x()},E.prototype.$22x=function(){var U=this;if(U._debugInfo){var W=U._debugInfo.grid,B=U._debugInfo.path,I=U.gv;W&&I.dm().remove(W),B&&I.dm().remove(B),U._debugInfo=null}}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);
!function(L,$){"use strict";var z="ht",B=z+".layout.",E=L[z]||module.parent.exports.ht,t=E.List,i=E.DataModel,M=E.Node,H=E.Edge,s=E.Group,h=Math,Y=h.sqrt,W=h.random,x=h.max,G=h.min,e=function(W){return W*W};E.Default.getInternal().addMSMap({ms_force:function(q){q._interval=50,q._stepCount=10,q._motionLimit=.01,q._edgeRepulsion=.65,q._nodeRepulsion=.65,q._damper=1,q._maxMotion=0,q._motionRatio=0,q.init=function($){var R=this;$ instanceof i?R.dm=$:R.gv=$,R._nodeMap={},R._nodes=new t,R._edges=new t},q.start=function(){var t=this,p=t.gv;if(!t._timer){var k=t.cdm=p?p.dm():t.dm;k.mm(t.handleDataModelChange,t),k.md(t.handleDataPropertyChange,t),p&&p.mp(t.handleGV,t),k.each(function(b){if(t.isVisible(b)&&t.isLayoutable(b)&&b instanceof M)if(t instanceof y){var Q=b.p3();b.p3([Q[0]+W(),Q[1]+W(),Q[2]+W()])}else Q=b.p(),b.p(Q.x+W(),Q.y+W())}),t._timer=setInterval(function(){t.relax()},t._interval),t._damper=1}},q.stop=function(){var U=this;U._timer&&(U.cdm.umm(U.handleDataModelChange,U),U.cdm.umd(U.handleDataPropertyChange,U),U.gv&&U.gv.ump(U.handleGV,U),clearInterval(U._timer),delete U._timer,delete U.cdm)},q.handleGV=function(J){var X=this;if("dataModel"===J.property){var y=J.oldValue,H=J.newValue;y&&(y.umm(X.handleDataModelChange,X),y.umd(X.handleDataPropertyChange,X)),this.cdm=H,H.mm(X.handleDataModelChange,X),H.md(X.handleDataPropertyChange,X)}},q.relax=function(){var O=this;if(!(O._damper<.1&&O._maxMotion<O._motionLimit)){this.cdm.each(function(t){O.isVisible(t)&&(t instanceof H?O.addEdge(t):t instanceof M&&O.addNode(t))});for(var N,l,A=0,s=O._edges,Z=O._nodes,Y=Z.size();A<O._stepCount;A++){for(s.each(O.relaxEdge,O),N=0;Y>N;N++)for(l=0;Y>l;l++)O.relaxNode(Z.get(N),Z.get(l));O.moveNode()}O._isAdjusting=1,Z.each(function(w){w.fix||(w.p?w.v.p3(w.p):w.v.p(w.x,w.y))}),delete O._isAdjusting,O._nodeMap={},Z.clear(),s.clear(),O.onRelaxed()}},q.onRelaxed=function(){},q.isRunning=function(){return!!this._timer},q.isVisible=function(i){return i.s("layoutable")===!1?!1:this.gv?this.gv.isVisible(i):!0},q.isLayoutable=function(t){if(t.s("layoutable")===!1)return!1;if(t instanceof s)return!1;var g=this;return g.gv?g.gv.isMovable(t)&&!g.gv.isSelected(t):!(g.cdm||g.dm).sm().co(t)},q.getNodeRepulsion=function(){return this._nodeRepulsion},q.setNodeRepulsion=function(X){this._nodeRepulsion=X,this._damper=1},q.getEdgeRepulsion=function(){return this._edgeRepulsion},q.setEdgeRepulsion=function(n){this._edgeRepulsion=n,this._damper=1},q.getStepCount=function(){return this._stepCount},q.setStepCount=function(Z){this._stepCount=Z,this._damper=1},q.getInterval=function(){return this._interval},q.setInterval=function(j){var D=this;D._interval!==j&&(D._interval=j,D._timer&&(clearInterval(D._timer),D._timer=setInterval(function(){D.relax()},j)))},q.handleDataPropertyChange=function(R){!this._isAdjusting&&this.isVisible(R.data)&&(this._damper=1)},q.handleDataModelChange=function(){this._damper=1},q.damp=function(){var X=this._maxMotion,J=this._damper;this._motionRatio<=.001&&((.2>X||X>1&&.9>J)&&J>.01?this._damper-=.01:.4>X&&J>.003?this._damper-=.003:J>1e-4&&(this._damper-=1e-4)),X<this._motionLimit&&(this._damper=0)}}}),E.layout.ForceLayout=function($){this.init($)},E.Default.def(B+"ForceLayout",$,{ms_force:1,getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(X){this._limitBounds=X,this._damper=1},getNodeSize:function(C){var z=this.gv;return z&&z.getDataUIBounds?z.getDataUIBounds(C):C.getRect()},addNode:function(K){var l=this,E=l._nodeMap[K._id];if(E)return E;var A=K.p();E={v:K,x:A.x,y:A.y,dx:0,dy:0,fix:!l.isLayoutable(K),s:l.getNodeSize(K)};var q=E.s,S=Y(e(q.width)+e(q.height))*l._nodeRepulsion;return E.r=1>S?100:S,l._nodeMap[K._id]=E,l._nodes.add(E),E},addEdge:function(X){if(X._40I&&X._41I){var o=this,O=o.addNode(X._40I),R=o.addNode(X._41I),D={s:O,t:R};R=R.s,O=O.s;var z=R.width+O.width,V=R.height+O.height;D.length=Y(z*z+V*V)*o._edgeRepulsion,D.length<=0&&(D.length=100),o._edges.add(D)}},relaxEdge:function(z){var Z=z.t,s=z.s,E=Z.x-s.x,g=Z.y-s.y,v=Y(E*E+g*g),q=100*z.length,X=.25*E/q*v,y=.25*g/q*v;Z.dx=Z.dx-X,Z.dy=Z.dy-y,s.dx=s.dx+X,s.dy=s.dy+y},relaxNode:function(Y,k){if(Y!==k){var V=0,e=0,r=Y.x-k.x,G=Y.y-k.y,P=r*r+G*G;0===P?(V=W(),e=W()):36e4>P&&(V=r/P,e=G/P);var $=Y.r*k.r/400;V*=$,e*=$,Y.dx+=V,Y.dy+=e,k.dx-=V,k.dy-=e}},moveNode:function(){var i=this,B=i._limitBounds,T=i._maxMotion,u=0,Z=i._damper;i._nodes.each(function(D){if(!D.fix){var l=D.dx*Z,E=D.dy*Z;if(D.dx=l/2,D.dy=E/2,u=x(Y(l*l+E*E),u),D.x+=x(-40,G(40,l)),D.y+=x(-40,G(40,E)),B){D.x<B.x&&(D.x=B.x,i.adjust(1,0)),D.y<B.y&&(D.y=B.y,i.adjust(0,1));var W=D.s;D.x+W.width>B.x+B.width&&(D.x=B.x+B.width-W.width,i.adjust(-1,0)),D.y+W.height>B.y+B.height&&(D.y=B.y+B.height-W.height,i.adjust(0,-1))}}}),i._maxMotion=u,i._motionRatio=u>0?T/u-1:0,i.damp()},adjust:function(P,c){var S=this._limitBounds;this._nodes.each(function(N){P>0?(!S||N.x+N.s.width+P<S.x+S.width)&&(N.x+=P):(!S||N.x+P>S.x)&&(N.x+=P),c>0?(!S||N.y+N.s.height+c<S.y+S.height)&&(N.y+=c):(!S||N.y+c>S.y)&&(N.y+=c)})}});var y=E.layout.Force3dLayout=function(E){this.init(E)};E.Default.def(B+"Force3dLayout",$,{ms_force:1,getNodeSize3d:function(P){return P.s3()},addNode:function(p){var x=this,B=x._nodeMap[p._id];if(B)return B;B={v:p,p:p.p3(),d:[0,0,0],fix:!x.isLayoutable(p),s:x.getNodeSize3d(p)};var t=B.s,s=E.Default.getDistance(t)*x._nodeRepulsion;return B.r=1>s?100:s,x._nodeMap[p._id]=B,x._nodes.add(B),B},addEdge:function(s){if(s._40I&&s._41I){var G=this,x=G.addNode(s._40I),w=G.addNode(s._41I),B={s:x,t:w};w=w.s,x=x.s,B.length=Y(e(w[0]+x[0])+e(w[1]+x[1])+e(w[2]+x[2]))*G._edgeRepulsion,B.length<=0&&(B.length=100),G._edges.add(B)}},relaxEdge:function(r){var L=r.t.p,n=r.s.p,u=r.t.d,j=r.s.d,y=L[0]-n[0],P=L[1]-n[1],U=L[2]-n[2],x=Y(y*y+P*P+U*U),M=100*r.length,O=.25*y/M*x,J=.25*P/M*x,o=.25*U/M*x;u[0]-=O,u[1]-=J,u[2]-=o,j[0]+=O,j[1]+=J,j[2]+=o},relaxNode:function(g,y){if(g!==y){var T=g.p,z=y.p,R=0,h=0,n=0,p=T[0]-z[0],l=T[1]-z[1],O=T[2]-z[2],f=p*p+l*l+O*O;0===f?(R=W(),h=W(),n=W()):216e6>f&&(R=p/f,h=l/f,n=O/f);var k=g.r*y.r/400,Q=g.d,Y=y.d;R*=k,h*=k,n*=k,Q[0]+=R,Q[1]+=h,Q[2]+=n,Y[0]-=R,Y[1]-=h,Y[2]-=n}},moveNode:function(){var E=this,U=E._maxMotion,d=0,K=E._damper;E._nodes.each(function(l){if(!l.fix){var r=l.p,j=l.d,$=j[0]*K,R=j[1]*K,U=j[2]*K;j[0]=$/2,j[1]=R/2,j[2]=U/2,d=x(Y($*$+R*R+U*U),d),r[0]+=x(-40,G(40,$)),r[1]+=x(-40,G(40,R)),r[2]+=x(-40,G(40,U))}}),E._maxMotion=d,E._motionRatio=d>0?U/d-1:0,E.damp()}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);